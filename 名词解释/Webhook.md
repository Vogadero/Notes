# 什么是 Webhook？

Webhook 是一种用户定义的 HTTP 回调（回调函数），当某个事件发生时，系统会向预先配置的 URL 发送一个 HTTP 请求，从而实现不同系统之间的实时通知和数据推送。

---

## Webhook 的工作原理

1. **注册 Webhook URL**  
   目标系统（接收方）提前向源系统（触发方）提供一个可接受 HTTP 请求的接口 URL。

2. **事件触发**  
   当源系统发生特定事件（例如：订单创建、代码提交、支付成功等）时，会自动向注册的 Webhook URL 发送一个 HTTP 请求（通常是 POST 请求）。

3. **接收与处理**  
   目标系统接收到请求后，解析请求中的数据，执行相应的业务逻辑（如更新状态、推送通知、触发后续流程等）。

---

## Webhook 的优势

- **实时性强**  
  与轮询相比，Webhook 能即时推送数据，减少延迟并节省资源。

- **降低系统负载**  
  通过事件驱动通知，避免了频繁或无效的查询请求。

- **跨系统集成方便**  
  不同平台和服务间通过标准 HTTP 协议即可轻松集成。

---

## Webhook 常见应用场景

- 支付平台向商户推送支付结果通知  
- Git 代码托管触发持续集成（CI）任务  
- 订单系统通知仓库系统更新库存  
- 第三方服务实现实时消息推送

---

## 如何设计一个安全可靠的 Webhook

1. **身份验证**  
   - 使用签名或令牌验证请求来源，防止伪造请求。  
   - 例如，源系统在请求头中加入加密的签名，目标系统接收后验证真实性。

2. **数据加密**  
   - 支持 HTTPS 传输，保障数据传输安全。

3. **请求幂等性**  
   - 设计接口时考虑重复调用的影响，避免重复处理导致错误。

4. **失败重试机制**  
   - 如果目标系统处理失败，源系统应支持重试机制，确保消息最终送达。

5. **日志记录与监控**  
   - 监控请求成功率与延迟，及时发现异常。

---

## Webhook 与 API 的区别

| 特性     | Webhook                        | API 调用                         |
| -------- | ------------------------------ | -------------------------------- |
| 调用方式 | 由事件源主动推送，系统异步回调 | 由客户端主动请求，客户端发起调用 |
| 通信方向 | 服务端向客户端推送数据         | 客户端向服务端请求数据           |
| 实时性   | 高                             | 取决于客户端请求频率             |
| 资源消耗 | 低（减少轮询）                 | 高（频繁轮询可能浪费资源）       |

---

## 简单示例 — 一个典型的 Webhook 实现（Node.js）

```javascript
const express = require('express');
const app = express();

app.use(express.json());

app.post('/webhook', (req, res) => {
  // 验证请求合法性（如自定义签名验证）
  const event = req.body.event;
  const payload = req.body.data;

  console.log(`收到事件: ${event}`);
  console.log('数据：', payload);

  // 处理事件逻辑 ...
  
  res.status(200).send('Webhook 接收成功');
});

app.listen(3000, () => {
  console.log('Webhook 服务启动，监听端口 3000');
});
```

---

## 总结

Webhook 是实现系统间实时通信与自动化的重要工具，通过事件驱动模式推送数据，极大提升了交互效率和系统响应速度。合理设计和安全防护是保障稳定运行的关键。未来，随着微服务和云应用的普及，Webhook 将会有更加广泛的应用前景。

---

## 参考资料

- [Webhook 官方定义 - Wikipedia](https://en.wikipedia.org/wiki/Webhook)  
- 各大云服务商 Webhook 文档（如 GitHub、Stripe、阿里云等）
